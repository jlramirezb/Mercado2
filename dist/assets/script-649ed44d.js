let o=0,c=[],u=[{name:"Manzanas",type:"weight"},{name:"Pan",type:"unit"},{name:"Leche",type:"unit"},{name:"Arroz",type:"weight"},{name:"Huevos",type:"unit"}];function g(){const t=document.getElementById("item-select");t.innerHTML='<option value="">Seleccionar artículo</option>',u.forEach(e=>{const n=document.createElement("option");n.value=e.name,n.textContent=e.name,t.appendChild(n)})}function v(){const t=document.getElementById("exchange-rate"),e=parseFloat(t.value);e>0?(o=e,document.getElementById("exchange-rate-form").style.display="none",document.getElementById("item-form").style.display="block",g(),alert(`Tipo de cambio establecido a ${o} VES por 1 USD`)):alert("Por favor, ingrese un tipo de cambio válido mayor que 0.")}function S(){document.getElementById("new-item-form").style.display="block"}function L(){const t=document.getElementById("new-item-name").value.trim(),e=document.getElementById("new-item-type").value;t?(u.push({name:t,type:e}),g(),document.getElementById("item-select").value=t,document.getElementById("new-item-name").value="",document.getElementById("new-item-form").style.display="none",alert(`Nuevo artículo "${t}" agregado a la lista.`)):alert("Por favor, ingrese un nombre para el nuevo artículo.")}function y(){const t=document.getElementById("item-type").value,e=document.getElementById("item-unit"),n=document.getElementById("item-quantity");t==="weight"?(e.style.display="block",n.placeholder="Peso"):(e.style.display="none",n.placeholder="Cantidad")}function x(){const t=document.getElementById("item-select"),e=document.getElementById("item-type"),n=document.getElementById("item-quantity"),a=document.getElementById("item-unit"),d=document.getElementById("item-price"),i=document.getElementById("item-currency"),l=t.value,p=e.value,E=parseFloat(n.value),B=p==="weight"?a.value:"unidad",m=parseFloat(d.value),I=i.value;if(l&&E>0&&m>0){const f=I==="USD"?m:m/o,h=I==="VES"?m:m*o;c.push({name:l,type:p,quantity:E,unit:B,priceUSD:f,priceVES:h}),s(),r(),t.value="",n.value="",d.value=""}else alert("Por favor, complete todos los campos correctamente.")}function s(){const t=document.getElementById("items-body");t.innerHTML="",c.forEach((e,n)=>{const a=t.insertRow();a.insertCell(0).textContent=e.name,a.insertCell(1).textContent=`${e.quantity} ${e.unit}`,a.insertCell(2).textContent=e.priceVES.toFixed(2),a.insertCell(3).textContent=e.priceUSD.toFixed(2);const d=a.insertCell(4),i=document.createElement("button");i.textContent="Editar",i.className="action-button edit-button",i.onclick=()=>w(n);const l=document.createElement("button");l.textContent="Eliminar",l.className="action-button delete-button",l.onclick=()=>C(n),d.appendChild(i),d.appendChild(l)})}function r(){const t=c.reduce((n,a)=>n+a.priceVES*a.quantity,0),e=c.reduce((n,a)=>n+a.priceUSD*a.quantity,0);document.getElementById("total-ves").textContent=t.toFixed(2),document.getElementById("total-usd").textContent=e.toFixed(2)}function w(t){const e=c[t];document.getElementById("item-select").value=e.name,document.getElementById("item-type").value=e.type,document.getElementById("item-quantity").value=e.quantity,e.type==="weight"?(document.getElementById("item-unit").value=e.unit,document.getElementById("item-unit").style.display="block"):document.getElementById("item-unit").style.display="none",document.getElementById("item-price").value=e.priceUSD,document.getElementById("item-currency").value="USD",c.splice(t,1),s(),r()}function C(t){confirm("¿Está seguro de que desea eliminar este artículo?")&&(c.splice(t,1),s(),r())}function b(){const t={exchangeRate:o,items:c,productList:u};localStorage.setItem("marketList",JSON.stringify(t)),alert("Lista guardada correctamente.")}function k(){const t=localStorage.getItem("marketList");if(t){const e=JSON.parse(t);o=e.exchangeRate,c=e.items,u=e.productList,document.getElementById("exchange-rate").value=o,document.getElementById("exchange-rate-form").style.display="none",document.getElementById("item-form").style.display="block",g(),s(),r(),alert("Lista cargada correctamente.")}else alert("No hay lista guardada para cargar.")}document.addEventListener("DOMContentLoaded",function(){const t=localStorage.getItem("marketList");if(t){document.getElementById("load-list").style.display="block";const e=JSON.parse(t);e.exchangeRate&&(o=e.exchangeRate,document.getElementById("exchange-rate").value=o,v())}else document.getElementById("load-list").style.display="none";document.getElementById("item-type").addEventListener("change",y),document.getElementById("item-select").addEventListener("change",function(){const e=u.find(n=>n.name===this.value);e&&(document.getElementById("item-type").value=e.type,y())}),document.getElementById("set-exchange-rate").addEventListener("click",v),document.getElementById("show-new-item-form").addEventListener("click",S),document.getElementById("add-new-item").addEventListener("click",L),document.getElementById("add-item").addEventListener("click",x),document.getElementById("save-list").addEventListener("click",b),document.getElementById("load-list").addEventListener("click",k),y()});
